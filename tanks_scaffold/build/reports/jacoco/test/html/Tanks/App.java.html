<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>App.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">tanks_scaffold</a> &gt; <a href="index.source.html" class="el_package">Tanks</a> &gt; <span class="el_source">App.java</span></div><h1>App.java</h1><pre class="source lang-java linenums">package Tanks;

import processing.core.PApplet;
import processing.core.PImage;
import processing.data.JSONArray;
import processing.data.JSONObject;
import processing.event.MouseEvent;
import java.io.*;
import java.util.*;
import java.util.ArrayList;
import java.util.List;



/**
 * The App class is the main entry point for the Tanks game. It extends the PApplet class from the Processing library
 * and manages game initialization, rendering, and logic.
 */


public class App extends PApplet {
<span class="fc" id="L22">   private List&lt;Tank&gt; tanks = new ArrayList&lt;&gt;();</span>

   public static final int CELLSIZE = 32; 
   public static final int CELLHEIGHT = 32;

   public static final int CELLAVG = 32;
   public static final int TOPBAR = 0;
   public List&lt;int[]&gt; treeCoordinates;
   public List&lt;int[]&gt; tankCoordinates; 

<span class="fc" id="L32">   public static int WIDTH = 864;</span>
<span class="fc" id="L33">   public static int HEIGHT = 640; </span>
<span class="fc" id="L34">   public static final int BOARD_WIDTH = WIDTH/CELLSIZE;</span>
   public static final int BOARD_HEIGHT = 20;

<span class="fc" id="L37">   public ArrayList&lt;Integer&gt;[] xCoordinates = new ArrayList[28];</span>
   // Array of arrays to store y coordinates
<span class="fc" id="L39">   public ArrayList&lt;ArrayList&lt;Integer&gt;&gt;[] yCoordinates = new ArrayList[28];</span>

   public static final int FPS = 30;
<span class="fc" id="L42">   public static int parachutes = 1; </span>

   public String configPath;

<span class="fc" id="L46">   public static Random random = new Random();</span>
   public PImage[] background; //PImage array for the backgrounds
   public List&lt;String&gt; currentLayout; // String list for the current level 
   public PImage treeImage; // Image for trees
   public int treeColor; 
   public Map&lt;Character, PImage&gt; playerImage; // Map to store player images
   public Map&lt;Character, Integer&gt; playerColor; // Map to store player colors

   public int currentlevel;
   public JSONObject config; //JSONObject reading the json file
   public String[] terrainColor;
   public int redColor;
   public int greenColor;
   public int blueColor;
<span class="fc" id="L60">   public boolean istankinitialised = false; </span>
<span class="fc" id="L61">   public int currentTankIndex = 0; // Index of the currently controlled tank</span>
   public  int[][] terrainHeightMap;
   
   private static final float ROTATION_SPEED = 3.0f; // Rotation speed in radians per second
   public PImage fuelImage;
<span class="fc" id="L66">   protected List&lt;Explosion&gt; explosions = new ArrayList&lt;&gt;();</span>
   public static PImage parachuteImage;
   public static float wind; // Current wind value
   private PImage windImageRight; // Image for wind blowing to the right
   private PImage windImageLeft; // Image for wind blowing to the left
   private PImage currentWindImage; // Current wind image based on direction

   private Scoreboard scoreboard;
   private HelpBox helpBox;
<span class="fc" id="L75">   private boolean gameOver = false; // To track if the game is over</span>
<span class="fc" id="L76">   private boolean levelEnded = false; // To track if the current level has ended</span>
   private long levelEndTime; // To store the time when the level ended
<span class="fc" id="L78">   private long levelEndDelay = 1000; // 1-second delay before loading the next level</span>
   private List&lt;Map.Entry&lt;Character, Integer&gt;&gt; finalScores; // To store final scores for display
<span class="fc" id="L80">   private long arrowDisplayStartTime = 0;</span>
 


    /**
     * Constructs the App object with the config.json file path.
     */


<span class="fc" id="L89">   public App() {</span>
<span class="fc" id="L90">       this.configPath = &quot;config.json&quot;;</span>
<span class="fc" id="L91">   }</span>

   /**
    * Initialise the setting of the window size.
    */
   @Override
   public void settings() {
<span class="fc" id="L98">       size(864, 640);</span>
<span class="fc" id="L99">   }</span>

   /**
    * Load all resources such as images. Initialise the elements such as the player and map elements.
    */
   @Override
   public void setup() {
<span class="fc" id="L106">       frameRate(FPS);</span>

<span class="fc" id="L108">       currentlevel = 0;</span>

       // Load JSON configuration file
<span class="fc" id="L111">       config = loadJSONObject(configPath);</span>

       // Extract levels from JSON file
<span class="fc" id="L114">       JSONArray levels = config.getJSONArray(&quot;levels&quot;);</span>
<span class="fc" id="L115">       int size = levels.size();</span>
<span class="fc" id="L116">       background = new PImage[size];</span>

<span class="fc bfc" id="L118" title="All 2 branches covered.">       for (int i = 0; i &lt; size; i++) {</span>
<span class="fc" id="L119">           JSONObject level = levels.getJSONObject(i);</span>
<span class="fc" id="L120">           String bgString = level.getString(&quot;background&quot;);</span>
<span class="fc" id="L121">           String bgPath = &quot;src/main/resources/Tanks/&quot; + bgString;</span>
<span class="fc" id="L122">           background[i] = loadImage(bgPath);</span>
       }

       // Load the layout

<span class="fc" id="L127">       currentLayout = loadLayout(currentlevel);</span>
<span class="fc" id="L128">       fuelImage = loadImage(&quot;src/main/resources/Tanks/fuel.png&quot;);</span>
<span class="fc" id="L129">       parachuteImage = loadImage(&quot;src/main/resources/Tanks/parachute.png&quot;);</span>
<span class="fc" id="L130">       windImageRight = loadImage(&quot;src/main/resources/Tanks/wind.png&quot;);</span>
<span class="fc" id="L131">       windImageLeft = loadImage(&quot;src/main/resources/Tanks/wind-1.png&quot;);</span>

<span class="fc" id="L133">       wind = random(-35, 35); // Generates a random wind value between -35 and 35</span>
<span class="fc" id="L134">       updateWindImage(); // Sets the appropriate wind image based on the wind direction</span>

 

    // Extract tree image and its color according to the current level 

<span class="pc bpc" id="L140" title="1 of 2 branches missed.">    if (currentlevel != 1) {</span>
<span class="fc" id="L141">        String treeImagePath = &quot;src/main/resources/Tanks/&quot; + levels.getJSONObject(currentlevel).getString(&quot;trees&quot;);</span>
<span class="fc" id="L142">        treeImage = loadImage(treeImagePath); // Store the trees image for the current level index</span>
<span class="fc" id="L143">        treeImage.resize(CELLSIZE, CELLHEIGHT);</span>
    }
       

<span class="fc" id="L147">       String color = config.getJSONArray(&quot;levels&quot;).getJSONObject(currentlevel).getString(&quot;foreground-colour&quot;);</span>
<span class="fc" id="L148">       this.terrainColor = color.split(&quot;,&quot;); </span>
<span class="fc" id="L149">       redColor = Integer.parseInt(terrainColor[0]);</span>
<span class="fc" id="L150">       greenColor = Integer.parseInt(terrainColor[1]);</span>
<span class="fc" id="L151">       blueColor = Integer.parseInt(terrainColor[2]);</span>
<span class="fc" id="L152">       initializeHeightCoordinates(currentLayout);</span>

<span class="fc" id="L154">    scoreboard = new Scoreboard(this);</span>
<span class="pc bpc" id="L155" title="1 of 2 branches missed.">    for (Tank tank : tanks) {</span>
<span class="nc" id="L156">        scoreboard.registerPlayer(tank.getPlayerIdentifier(), tank.getColor());</span>
<span class="nc" id="L157">    }</span>

<span class="fc" id="L159">    helpBox = new HelpBox(this); // Initialize the help box</span>

<span class="fc" id="L161">    arrowDisplayStartTime = millis();</span>


       
<span class="fc" id="L165">    }</span>

    /**
     * Loads the layout for the specified level.
     *
     * @param index The level index.
     * @return A list of strings representing the layout.
     */


   public List&lt;String&gt; loadLayout(int index) {
<span class="fc" id="L176">       List&lt;String&gt; layout = new ArrayList&lt;&gt;();</span>
       try {
           // Read the .txt file for the given level
<span class="fc" id="L179">           String levelName = &quot;level&quot; + (index + 1) + &quot;.txt&quot;;</span>
<span class="fc" id="L180">           BufferedReader reader = createReader(levelName); // BufferedReader reads from a character input stream</span>
           String line;
<span class="fc bfc" id="L182" title="All 2 branches covered.">           while ((line = reader.readLine()) != null) {</span>
<span class="fc" id="L183">               layout.add(line);</span>
           }
<span class="fc" id="L185">           reader.close();</span>
<span class="nc" id="L186">       } catch (Exception e) {</span>
<span class="nc" id="L187">           e.printStackTrace();</span>
<span class="fc" id="L188">       }</span>

<span class="fc" id="L190">       return layout;</span>
   }

   /**
     * Initializes the height coordinates for the terrain based on the layout.
     * 
     * If 'X' is found it depicts the terrain and 'T' depicts trees
     * @param layout The layout of the current level.
     */


    public void initializeHeightCoordinates(List&lt;String&gt; layout) {
<span class="fc" id="L202">        treeCoordinates = new ArrayList&lt;&gt;(); // Initialize the list here</span>

        // Initializing the arrays
<span class="fc bfc" id="L205" title="All 2 branches covered.">        for (int i = 0; i &lt; 28; i++) {</span>
<span class="fc" id="L206">            xCoordinates[i] = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L207">            yCoordinates[i] = new ArrayList&lt;&gt;();</span>
        }

        // Processing the layout to find 'X' and 'T'
<span class="fc bfc" id="L211" title="All 2 branches covered.">        for (int y = 0; y &lt; layout.size(); y++) {</span>
<span class="fc" id="L212">            String line = layout.get(y);</span>
<span class="fc bfc" id="L213" title="All 2 branches covered.">            for (int x = 0; x &lt; line.length(); x++) {</span>
<span class="fc" id="L214">                char part = line.charAt(x);</span>
<span class="pc bpc" id="L215" title="1 of 4 branches missed.">                if (part == 'X' &amp;&amp; x &lt; 28) {</span>
<span class="fc" id="L216">                    xCoordinates[x].add(x * CELLSIZE);</span>
                    
<span class="fc" id="L218">                    ArrayList&lt;Integer&gt; newYList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L219" title="All 2 branches covered.">                    for (int j = 0; j &lt; 32; j++) {</span>
<span class="fc" id="L220">                        newYList.add(y * CELLHEIGHT);</span>
                    }
<span class="fc" id="L222">                    yCoordinates[x].add(newYList);</span>
<span class="pc bpc" id="L223" title="1 of 4 branches missed.">                } else if (part == 'T' &amp;&amp; currentlevel != 1) {</span>
<span class="fc" id="L224">                    treeCoordinates.add(new int[]{x * CELLSIZE, y * CELLSIZE});</span>
                }
            }
        }
<span class="fc" id="L228">        updateYCoordinates(yCoordinates);</span>
<span class="fc" id="L229">        updateYCoordinates(yCoordinates);</span>

<span class="fc" id="L231">    }</span>

    /**
     * Draws the terrain based on the height coordinates.
     */


    public void drawTerrain() {
<span class="fc" id="L239">        noStroke();  // Disable outlines for the rectangles drawn for the terrain</span>
<span class="fc" id="L240">        fill(redColor, greenColor, blueColor);  // Setting the color of the rectangles</span>
    
        // Draw rectangles based on yCoordinates
<span class="fc" id="L243">        int x = 0;</span>
<span class="fc bfc" id="L244" title="All 2 branches covered.">        for (ArrayList&lt;ArrayList&lt;Integer&gt;&gt; yListArray : yCoordinates) {</span>
<span class="pc bpc" id="L245" title="2 of 4 branches missed.">            if (yListArray != null &amp;&amp; !yListArray.isEmpty()) {</span>
<span class="fc bfc" id="L246" title="All 2 branches covered.">                for (ArrayList&lt;Integer&gt; yList : yListArray) {</span>
<span class="fc bfc" id="L247" title="All 2 branches covered.">                    for (Integer yCoord : yList) {</span>
                        // Draw a rectangle with width of 1 pixel
<span class="fc" id="L249">                        rect(x, yCoord, 1, HEIGHT - yCoord);</span>
<span class="fc" id="L250">                        x++;</span>
<span class="fc" id="L251">                    }</span>
<span class="fc" id="L252">                }</span>
            }
            // Adjusting the x position to align to the nearest cell boundary after drawing all lines in a column
<span class="fc" id="L255">            x = (x + CELLSIZE - 1) / CELLSIZE * CELLSIZE;</span>
        }
    
        // Drawing trees based on treeCoordinates
<span class="fc bfc" id="L259" title="All 2 branches covered.">        for (int[] treeCoord : treeCoordinates) {</span>
<span class="pc bpc" id="L260" title="2 of 4 branches missed.">            if (treeCoord != null &amp;&amp; treeCoord.length == 2) {</span>
<span class="fc" id="L261">                int index = treeCoord[0] / 32;</span>
<span class="fc" id="L262">                int yCoord = yCoordinates[index].get(0).get(16);</span>
<span class="fc" id="L263">                image(treeImage, treeCoord[0], yCoord - 25);</span>
            }
<span class="fc" id="L265">        }</span>
    
        // Initialize tanks if not already initialized
<span class="fc bfc" id="L268" title="All 2 branches covered.">        if (!istankinitialised) {</span>
<span class="fc" id="L269">            createTanksFromLayout();</span>
        }
<span class="fc" id="L271">    }</span>

   /**
     * Updates the y coordinates to smooth out the terrain by taking moving average of 32 values twice.
     *
     * @param yCoordinates The y coordinates of the terrain.
     */
    

   
   public void updateYCoordinates(ArrayList&lt;ArrayList&lt;Integer&gt;&gt;[] yCoordinates) {

    // smooth the terrain by calculating the moving average of 32 values twice 
<span class="fc bfc" id="L284" title="All 2 branches covered.">       for (int i = 0; i &lt; yCoordinates.length - 1; i++) {</span>

           // Create a new ArrayList to store the smoothed y-coordinates for the current segment
<span class="fc" id="L287">           ArrayList&lt;ArrayList&lt;Integer&gt;&gt; newYCoordinates = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L289" title="All 2 branches covered.">           for (int j = 0; j &lt; yCoordinates[i].size(); j++) {</span>
<span class="fc" id="L290">               ArrayList&lt;Integer&gt; newYList = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L291" title="All 2 branches covered.">               for (int k = 0; k &lt; yCoordinates[i].get(j).size(); k++) {</span>
<span class="fc" id="L292">                   int sum = 0;</span>
<span class="fc" id="L293">                   int count = 0;</span>

                   // Calculate the sum of up to 32 y-coordinates starting from the current position k
                   // within the current segment
<span class="pc bpc" id="L297" title="1 of 4 branches missed.">                   for (int m = k; m &lt; yCoordinates[i].get(j).size() &amp;&amp; count &lt; 32; m++) {</span>
<span class="fc" id="L298">                       sum += yCoordinates[i].get(j).get(m);</span>
<span class="fc" id="L299">                       count++;</span>
                   }

                   // If less than 32 values were summed, continue summing from the next segment
<span class="pc bpc" id="L303" title="1 of 4 branches missed.">                   for (int m = 0; count &lt; 32 &amp;&amp; m &lt; yCoordinates[i + 1].get(j).size(); m++) {</span>
<span class="fc" id="L304">                       sum += yCoordinates[i + 1].get(j).get(m);</span>
<span class="fc" id="L305">                       count++;</span>
                   }
<span class="fc" id="L307">                   newYList.add(sum / 32);</span>
               }
<span class="fc" id="L309">               newYCoordinates.add(newYList);</span>
               
           }
<span class="fc" id="L312">           yCoordinates[i] = newYCoordinates;</span>
       }  
       
<span class="fc" id="L315">   }</span>

   /**
     * Creates tanks based on the layout.
     */


void createTanksFromLayout() {
<span class="fc" id="L323">    tankCoordinates = new ArrayList&lt;&gt;();</span>

    // First loop: Collects all tank coordinates based on character parts
<span class="fc bfc" id="L326" title="All 2 branches covered.">    for (int y = 0; y &lt; currentLayout.size(); y++) {</span>
<span class="fc" id="L327">        String line = currentLayout.get(y);</span>
<span class="fc bfc" id="L328" title="All 2 branches covered.">        for (int x = 0; x &lt; line.length(); x++) {</span>
<span class="fc" id="L329">            char part = line.charAt(x);</span>
<span class="fc bfc" id="L330" title="All 2 branches covered.">            if (!config.getJSONObject(&quot;player_colours&quot;).isNull(Character.toString(part))) {</span>
<span class="fc" id="L331">                tankCoordinates.add(new int[]{x * CELLSIZE, y * CELLHEIGHT, part}); // Add part to the array</span>
            }
        }
    }

    // Sorts the tankCoordinates based on the x coordinates (from left to right)
<span class="fc" id="L337">    Collections.sort(tankCoordinates, new Comparator&lt;int[]&gt;() {</span>
        @Override
        public int compare(int[] a, int[] b) {
<span class="fc" id="L340">            return a[0] - b[0]; // Compare x coordinates</span>
        }
    });

<span class="fc bfc" id="L344" title="All 2 branches covered.">    for (int[] tankCoord : tankCoordinates) {</span>
<span class="pc bpc" id="L345" title="2 of 4 branches missed.">        if (tankCoord != null &amp;&amp; tankCoord.length == 3) {</span>
<span class="fc" id="L346">            int x = tankCoord[0] - 10;</span>
<span class="fc" id="L347">            int terrainY = TerrainHeightAtX(x, yCoordinates, xCoordinates) - 25; // Adjust Y position for the tank</span>
<span class="fc" id="L348">            char playerIdentifier = (char) tankCoord[2]; // Use the character as player identifier</span>
<span class="fc" id="L349">            int tankColor = parseColor(playerIdentifier); // Get color based on the player identifier</span>
<span class="pc bpc" id="L350" title="1 of 2 branches missed.">            if (terrainY != -1) { // Check if terrain height is valid</span>
                // Pass the initial value of 3 for parachutes and include player identifier
<span class="fc" id="L352">                Tank tank = new Tank(this, x, terrainY, CELLSIZE, CELLHEIGHT, tankColor, yCoordinates, xCoordinates, 3, playerIdentifier);</span>
<span class="fc" id="L353">                tank.adjustToTerrain(); // Ensure the tank is correctly placed on the terrain</span>
<span class="fc" id="L354">                tanks.add(tank);</span>
            }
        }
<span class="fc" id="L357">    }</span>

<span class="fc" id="L359">    istankinitialised = true; // tank is initialised</span>
<span class="fc" id="L360">}</span>



   /**
     * Parses the color for a tank based on the player identifier.
     *
     * @param playerIdentifier The player identifier.
     * @return The color as an integer.
     * 
     */



int parseColor(char playerIdentifier) {
    // Parsing color from JSON based on player identifier
<span class="fc" id="L376">    String colorString = config.getJSONObject(&quot;player_colours&quot;).getString(Character.toString(playerIdentifier));</span>
<span class="fc" id="L377">    String[] components = colorString.split(&quot;,&quot;);</span>
<span class="fc" id="L378">    int r = Integer.parseInt(components[0]);</span>
<span class="fc" id="L379">    int g = Integer.parseInt(components[1]);</span>
<span class="fc" id="L380">    int b = Integer.parseInt(components[2]);</span>
<span class="fc" id="L381">    return color(r, g, b);</span>
}



   /**
     * Calculates the terrain height at a given x-coordinate.
     *
     * @param x           The x-coordinate.
     * @param heightsList The list of height coordinates.
     * @param xValues     The x-coordinate values.
     * @return The terrain height at the given x-coordinate.
     */

   

    public int TerrainHeightAtX(int x, ArrayList&lt;ArrayList&lt;Integer&gt;&gt;[] heightsList, ArrayList&lt;Integer&gt;[] xValues) {
<span class="fc" id="L398">        int xIndex = x / 32; // Calculate the index of the x-coordinate</span>
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">        if (xIndex &lt; xValues.length) { // Check if xIndex is within the bounds of the xValues array</span>
<span class="fc" id="L400">            ArrayList&lt;ArrayList&lt;Integer&gt;&gt; listOfHeights = heightsList[xIndex];</span>
<span class="pc bpc" id="L401" title="1 of 2 branches missed.">            if (!listOfHeights.isEmpty()) {</span>
<span class="fc" id="L402">                ArrayList&lt;Integer&gt; heights = listOfHeights.get(0);</span>
<span class="fc" id="L403">                int heightIndex = x % 32; // Calculating the specific index of the height within the list</span>
<span class="fc bfc" id="L404" title="All 2 branches covered.">                if (heightIndex &lt; heights.size()) {</span>
<span class="fc" id="L405">                    return heights.get(heightIndex); // Return the height at the specific index</span>
                }
            }
        }
<span class="fc" id="L409">        return -1;</span>
    }

    /**
     * Draws the health bar for the current tank.
     */


    public void drawHealthBar() {
<span class="fc bfc" id="L418" title="All 2 branches covered.">        if (tanks.isEmpty()) {</span>
<span class="fc" id="L419">            return; </span>
        }
        
<span class="fc" id="L422">        Tank currentTank = tanks.get(currentTankIndex);</span>
<span class="fc" id="L423">        float healthWidth = map(currentTank.getHealth(), 0, 100, 0, 200);</span>
<span class="fc" id="L424">        float healthBarX = 400;</span>
<span class="fc" id="L425">        float healthBarY = 17;</span>
    
        // Draw the grey background rectangle with a grey border
<span class="fc" id="L428">        fill(255);  // White color for the lost health</span>
<span class="fc" id="L429">        stroke(192);  // Grey color for the border</span>
<span class="fc" id="L430">        rect(healthBarX, healthBarY, 200, 20);</span>
    
        // Draw the filled portion representing health
<span class="fc" id="L433">        noStroke();</span>
<span class="fc" id="L434">        fill(currentTank.getColor());</span>
<span class="fc" id="L435">        rect(healthBarX, healthBarY, healthWidth, 20);</span>
    
        // Draw the power indicator line
<span class="fc" id="L438">        float powerIndicatorX = healthBarX + map(currentTank.getPower(), 0, 100, 0, 200);</span>
<span class="fc" id="L439">        stroke(76, 153, 0);  // Power indicator line </span>
<span class="fc" id="L440">        line(powerIndicatorX, healthBarY, powerIndicatorX, healthBarY + 20);</span>
    
        // Draw the border of the health bar
<span class="fc" id="L443">        noFill();</span>
<span class="fc" id="L444">        stroke(0);</span>
<span class="fc" id="L445">        rect(healthBarX, healthBarY, 200, 20);</span>
    
        // Draw the health text
<span class="fc" id="L448">        fill(0);</span>
<span class="fc" id="L449">        String healthLabel = &quot;Health: &quot;;</span>
<span class="fc" id="L450">        String healthValue = Integer.toString((int) currentTank.getHealth());</span>
<span class="fc" id="L451">        String healthText = healthLabel + healthValue;</span>
<span class="fc" id="L452">        textSize(18);</span>
<span class="fc" id="L453">        textAlign(RIGHT);</span>
<span class="fc" id="L454">        text(healthText, healthBarX - 10, 35);</span>
<span class="fc" id="L455">    }</span>
    
    /**
     * Draws the power indicator for the current tank.
     */
    
    public void drawPower() {
        // Set the fill color to black

<span class="fc bfc" id="L464" title="All 2 branches covered.">        if (tanks.isEmpty()) return;  // Exit if there are no tanks to handle.</span>
<span class="fc" id="L465">        fill(0);</span>
    
        // Get the power of the current tank
<span class="fc" id="L468">        Tank currentTank = tanks.get(currentTankIndex);</span>
<span class="fc" id="L469">        int power = (int) currentTank.getPower(); // Casting the power to integer</span>
    
        // Display the power label and value
<span class="fc" id="L472">        String powerLabel = &quot;Power: &quot;;</span>
<span class="fc" id="L473">        String powerValue = Integer.toString(power); // Converting integer to string</span>
<span class="fc" id="L474">        String powerText = powerLabel + powerValue;</span>
        // Displays the power text above the health bar
<span class="fc" id="L476">        textSize(18);</span>
<span class="fc" id="L477">        textAlign(LEFT);</span>
<span class="fc" id="L478">        text(powerText, 289, 54); </span>
<span class="fc" id="L479">    }</span>

    /**
     * Updates the terrain after a collision.
     *
     * @param x The x-coordinate of the collision.
     * @param y The y-coordinate of the collision.
     */



    public void collisionUpdate(int x, int y) {
<span class="fc" id="L491">        int radius = 30;</span>
    
        // We need to consider that yCoordinates is an array, so we use .length for arrays
<span class="fc bfc" id="L494" title="All 2 branches covered.">        for (int i = x - radius; i &lt;= x + radius; i++) {</span>
<span class="pc bpc" id="L495" title="2 of 4 branches missed.">            if (i &gt;= 0 &amp;&amp; i &lt; yCoordinates.length * 32) {</span>
<span class="fc" id="L496">                int arrayIndex = i / 32; // Determines which ArrayList of ArrayLists to access</span>
<span class="fc" id="L497">                int valueIndex = i % 32; // Determines which Integer in the inner ArrayList to access</span>
    
                // Calculate the distance from the point of collision
<span class="fc" id="L500">                int distance = Math.abs(x - i);</span>
    
                // Calculate the new height based on the distance from the point of collision
<span class="fc" id="L503">                int newHeight = y + (int) Math.sqrt(Math.pow(radius, 2) - Math.pow(distance, 2));</span>
    
                // Update the height if the new height is greater than the current height
<span class="fc" id="L506">                ArrayList&lt;Integer&gt; heights = yCoordinates[arrayIndex].get(0); // Accessing the inner ArrayList</span>
<span class="pc bpc" id="L507" title="1 of 2 branches missed.">                if (newHeight &gt; heights.get(valueIndex)) {</span>
<span class="nc" id="L508">                    heights.set(valueIndex, newHeight);</span>
                }
            }
        }
<span class="fc" id="L512">        drawTerrain(); // Assuming drawTerrain is implemented elsewhere to redraw the terrain</span>
<span class="fc" id="L513">    }</span>

    /**
     * Updates the state of a tank, including handling parachute deployment and fall damage.
     *
     * @param tank The tank to update.
     */



    public void updateTankState(Tank tank) {
<span class="fc" id="L524">        int terrainHeight = TerrainHeightAtX((int) tank.getX(), yCoordinates, xCoordinates);</span>
<span class="pc bpc" id="L525" title="1 of 2 branches missed.">        boolean isMidair = tank.getY() + tank.getHeight() &lt; terrainHeight;</span>
    
<span class="pc bpc" id="L527" title="1 of 2 branches missed.">        if (isMidair) {</span>
<span class="nc bnc" id="L528" title="All 4 branches missed.">            if (!tank.isParachuteDeployed() &amp;&amp; tank.getParachutes() &gt; 0) {</span>
<span class="nc" id="L529">                tank.deployParachute();</span>
                // Descends with parachute at 60 pixels per second and type casting the result to integer
<span class="nc" id="L531">                int newY = (int) (tank.getY() + 60.0 / FPS);</span>
<span class="nc" id="L532">                tank.setY(newY);</span>
<span class="nc" id="L533">            } else {</span>
                // No parachute available or already deployed, falls faster
                double descentIncrement;
<span class="nc bnc" id="L536" title="All 2 branches missed.">                if (tank.isParachuteDeployed()) {</span>
<span class="nc" id="L537">                    descentIncrement = 60.0 / FPS;</span>
                } else {
<span class="nc" id="L539">                    descentIncrement = 120.0 / FPS;</span>
                }
<span class="nc" id="L541">                int newY = (int) (tank.getY() + descentIncrement);</span>
<span class="nc" id="L542">                tank.setY(newY);</span>
    
                // Checks if tank is still above the terrain
<span class="nc bnc" id="L545" title="All 2 branches missed.">                if (tank.getY() + tank.getHeight() &gt;= terrainHeight) {</span>
                    // Hits the ground without a parachute and calculate damage from the fall
<span class="nc" id="L547">                    int fallHeight = (int) (tank.getY() + tank.getHeight() - terrainHeight);</span>
<span class="nc" id="L548">                    tank.setHealth(tank.getHealth() - fallHeight); // 1hp damage per pixel fallen</span>
                }
<span class="nc" id="L550">            }</span>
        } else {

<span class="fc" id="L553">            int newY = terrainHeight - tank.getHeight();</span>
<span class="fc" id="L554">            tank.setY(newY);</span>
<span class="fc" id="L555">            tank.resetParachute();</span>
        }
    
        // Check if the tank is below the window and not supported by terrain
<span class="pc bpc" id="L559" title="3 of 4 branches missed.">        if (tank.getY() + tank.getHeight() &gt;= HEIGHT &amp;&amp; terrainHeight &lt; 0) {</span>
<span class="nc" id="L560">            tank.setHealth(0); // Set health to 0 to mark it for removal</span>
        }
<span class="fc" id="L562">    }</span>

    /**
     * Updates the wind image based on the current wind direction.
     */
    
    public void updateWindImage() {
<span class="fc bfc" id="L569" title="All 2 branches covered.">        if (wind &lt; 0) {</span>
<span class="fc" id="L570">            currentWindImage = windImageLeft;</span>
        } else {
<span class="fc" id="L572">            currentWindImage = windImageRight;</span>
        }
<span class="fc" id="L574">    }</span>

    /**
     * Manages the explosions, updating and drawing them, and applying damage to tanks.
     */

    public void manageExplosions() {
<span class="fc" id="L581">        Iterator&lt;Explosion&gt; iterator = explosions.iterator();</span>
<span class="fc bfc" id="L582" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L583">            Explosion explosion = iterator.next();</span>
<span class="fc" id="L584">            explosion.update();</span>
<span class="fc" id="L585">            explosion.draw();</span>
<span class="fc bfc" id="L586" title="All 2 branches covered.">            if (explosion.isDone()) {</span>
<span class="fc" id="L587">                explosion.applyDamage(tanks);</span>
<span class="fc" id="L588">                iterator.remove(); // Remove explosion after it finishes</span>
            }
<span class="fc" id="L590">        }</span>
<span class="fc" id="L591">    }</span>


    /**
     * Manages the tanks, updating their state and drawing them.
     */


    public void manageTanks() {
<span class="fc" id="L600">        Iterator&lt;Tank&gt; iterator = tanks.iterator();</span>
<span class="fc bfc" id="L601" title="All 2 branches covered.">        while (iterator.hasNext()) {</span>
<span class="fc" id="L602">            Tank tank = iterator.next();</span>
<span class="fc" id="L603">            updateTankState(tank); // Update the state of the tank, adjust position or check conditions</span>
<span class="pc bpc" id="L604" title="4 of 6 branches missed.">            if (tank.getHealth() &lt;= 0 || (tank.isOnGround() &amp;&amp; TerrainHeightAtX((int) tank.getX(), yCoordinates, xCoordinates) &lt; 0)) {</span>
<span class="nc" id="L605">                float explosionRadius = 30; // Standard explosion radius</span>
<span class="nc" id="L606">                explosions.add(new Explosion(this, tank.getX(), tank.getY(), explosionRadius, scoreboard, tank.getPlayerIdentifier()));</span>
<span class="nc" id="L607">                iterator.remove(); // Remove the tank safely using iterator</span>
<span class="nc" id="L608">            } else {</span>
<span class="fc" id="L609">                tank.draw(); // Draw the tank if it's still active</span>
            }
<span class="fc" id="L611">        }</span>
    
        // Update the current tank index to avoid out-of-bound errors
<span class="pc bpc" id="L614" title="1 of 4 branches missed.">        if (currentTankIndex &gt;= tanks.size() &amp;&amp; !tanks.isEmpty()) {</span>
<span class="nc" id="L615">            currentTankIndex = 0; // Reset to first tank or any valid index</span>
        }
<span class="fc" id="L617">    }</span>
    
    
    /**
     * Gets the scoreboard.
     *
     * @return The scoreboard.
     */

    public Scoreboard getScoreboard() {
<span class="fc" id="L627">        return this.scoreboard;  // Getter for the scoreboard</span>
    }

    public List&lt;Tank&gt; getTanks() {
<span class="fc" id="L631">        return tanks;</span>
    }

    public List&lt;Explosion&gt; getExplosions() {
<span class="fc" id="L635">        return explosions;</span>
    }

    public boolean isGameOver() {
<span class="fc" id="L639">        return gameOver;</span>
    }
 
    /**
     * Checks if the current level has ended.
     */
    

    public void checkLevelEnd() {
<span class="pc bpc" id="L648" title="3 of 4 branches missed.">        if (tanks.size() == 1 &amp;&amp; !levelEnded) {</span>
<span class="nc" id="L649">            levelEnded = true;</span>
<span class="nc" id="L650">            levelEndTime = millis(); // Capture the time when the level ended</span>
        }
<span class="fc" id="L652">    }</span>

    /**
     * Loads the next level.
     */
    
    
    public void loadNextLevel() {
<span class="nc bnc" id="L660" title="All 2 branches missed.">        if (currentlevel &lt; background.length - 1) {</span>
<span class="nc" id="L661">            currentlevel++;</span>
<span class="nc" id="L662">            prepareNextLevel(); // Call this to set up the next level</span>
        } else {
<span class="nc" id="L664">            endGame(); // End the game if there are no more levels</span>
        }
<span class="nc" id="L666">    }</span>

    /**
     * Prepares the game for the next level.
     * &lt;p&gt;
     * This method clears the current game state, loads the configuration for the next level,
     * updates the background image, foreground color, and tree image (if applicable), and initializes
     * the new level layout, terrain, and tanks. If there are no more levels, the game ends.
     */


    public void prepareNextLevel() {
        // Clear existing game state
<span class="nc" id="L679">        explosions.clear();</span>
<span class="nc" id="L680">        tanks.clear();</span>
    
        // Check if the next level exists
<span class="nc bnc" id="L683" title="All 2 branches missed.">        if (currentlevel &lt; background.length) {</span>
            // Update the background image according to the new level
<span class="nc" id="L685">            JSONObject levelConfig = config.getJSONArray(&quot;levels&quot;).getJSONObject(currentlevel);</span>
<span class="nc" id="L686">            background[currentlevel] = loadImage(&quot;src/main/resources/Tanks/&quot; + levelConfig.getString(&quot;background&quot;));</span>
    
            // Update the foreground color according to the new level
<span class="nc" id="L689">            String[] color = levelConfig.getString(&quot;foreground-colour&quot;).split(&quot;,&quot;);</span>
<span class="nc" id="L690">            redColor = Integer.parseInt(color[0]);</span>
<span class="nc" id="L691">            greenColor = Integer.parseInt(color[1]);</span>
<span class="nc" id="L692">            blueColor = Integer.parseInt(color[2]);</span>
    
            // Update tree image, if applicable
<span class="nc bnc" id="L695" title="All 2 branches missed.">            if (!levelConfig.isNull(&quot;trees&quot;)) {</span>
<span class="nc" id="L696">                String treeImagePath = &quot;src/main/resources/Tanks/&quot; + levelConfig.getString(&quot;trees&quot;);</span>
<span class="nc" id="L697">                treeImage = loadImage(treeImagePath);</span>
<span class="nc" id="L698">                treeImage.resize(CELLSIZE, CELLHEIGHT);</span>
<span class="nc" id="L699">            } else {</span>
<span class="nc" id="L700">                treeImage = null; // Clear tree image if not used in the level</span>
            }
    
            // Load and initialize the layout
<span class="nc" id="L704">            currentLayout = loadLayout(currentlevel);</span>
<span class="nc" id="L705">            initializeHeightCoordinates(currentLayout);</span>
<span class="nc" id="L706">            createTanksFromLayout();</span>
            // draw terrain based on the new layout
<span class="nc" id="L708">            drawTerrain();</span>
    
<span class="nc" id="L710">            levelEnded = false;  // Reset the flag indicating the level is ongoing</span>
<span class="nc" id="L711">        } else {</span>
<span class="nc" id="L712">            endGame();</span>
        }
<span class="nc" id="L714">    }</span>

    
    
    

    /**
     * Ends the game and displayes the final scores.
     */
    
   

    public void endGame() {
<span class="fc" id="L727">        gameOver = true; // Mark the game as over</span>
<span class="fc" id="L728">        finalScores = new ArrayList&lt;&gt;(scoreboard.getScores().entrySet());</span>
<span class="fc" id="L729">        finalScores.sort((a, b) -&gt; b.getValue().compareTo(a.getValue())); // Sort scores in descending order</span>
    
<span class="fc" id="L731">        displayWinner(); // Display the final scores</span>
<span class="fc" id="L732">    }</span>

    /**
     * Displays the winner and the final scores.
     */
    
     public void displayWinner() {
<span class="fc" id="L739">        fill(0); </span>
<span class="fc" id="L740">        textSize(36);</span>
<span class="fc" id="L741">        textAlign(CENTER, CENTER);</span>
    
<span class="pc bpc" id="L743" title="1 of 2 branches missed.">        if (!finalScores.isEmpty()) {</span>
<span class="fc" id="L744">            text(&quot;Player &quot; + finalScores.get(0).getKey() + &quot; wins!&quot;, width / 2, height / 2 - 50);</span>
    
<span class="fc" id="L746">            textSize(24);</span>
<span class="fc" id="L747">            float yPos = height / 2 + 20;</span>
<span class="fc bfc" id="L748" title="All 2 branches covered.">            for (Map.Entry&lt;Character, Integer&gt; score : finalScores) {</span>
<span class="fc" id="L749">                int color = scoreboard.getColor(score.getKey());</span>
<span class="fc" id="L750">                fill(color, 127); // Color slightly lighter and transparent</span>
<span class="fc" id="L751">                text(&quot;Player &quot; + score.getKey() + &quot;: &quot; + score.getValue(), width / 2, yPos);</span>
<span class="fc" id="L752">                yPos += 30;</span>
<span class="fc" id="L753">                delay(700); // Delay between showing scores</span>
<span class="fc" id="L754">            }</span>
        }
<span class="fc" id="L756">    }</span>

    
    
    /**
     * Restarts the game.
     */


    public void restartGame() {
<span class="fc" id="L766">        gameOver = false;</span>
<span class="fc" id="L767">        levelEnded = false;</span>
<span class="fc" id="L768">        currentlevel = 0; // Ensure you start from the first level</span>
    
        // Load and initialize layout and settings for the first level
<span class="fc" id="L771">        currentLayout = loadLayout(currentlevel);</span>
<span class="fc" id="L772">        initializeHeightCoordinates(currentLayout);</span>
    
        // Reset the images and color for terrain and trees based on the first level
<span class="fc" id="L775">        JSONObject levelConfig = config.getJSONArray(&quot;levels&quot;).getJSONObject(currentlevel);</span>
<span class="fc" id="L776">        background[currentlevel] = loadImage(&quot;src/main/resources/Tanks/&quot; + levelConfig.getString(&quot;background&quot;));</span>
<span class="fc" id="L777">        String[] color = levelConfig.getString(&quot;foreground-colour&quot;).split(&quot;,&quot;);</span>
<span class="fc" id="L778">        redColor = Integer.parseInt(color[0]);</span>
<span class="fc" id="L779">        greenColor = Integer.parseInt(color[1]);</span>
<span class="fc" id="L780">        blueColor = Integer.parseInt(color[2]);</span>
<span class="pc bpc" id="L781" title="1 of 2 branches missed.">        if (!levelConfig.isNull(&quot;trees&quot;)) {</span>
<span class="fc" id="L782">            String treeImagePath = &quot;src/main/resources/Tanks/&quot; + levelConfig.getString(&quot;trees&quot;);</span>
<span class="fc" id="L783">            treeImage = loadImage(treeImagePath);</span>
<span class="fc" id="L784">            treeImage.resize(CELLSIZE, CELLHEIGHT);</span>
<span class="fc" id="L785">        } else {</span>
<span class="nc" id="L786">            treeImage = null; // No trees in the first level</span>
        }
    
        // Clear existing game state
<span class="fc" id="L790">        tanks.clear();</span>
<span class="fc" id="L791">        explosions.clear();</span>
<span class="fc" id="L792">        createTanksFromLayout();</span>
<span class="fc" id="L793">        drawTerrain();</span>
    
        // Reset the scoreboard and scores
<span class="fc" id="L796">        scoreboard.resetScores();</span>
<span class="fc" id="L797">        finalScores = null;</span>
<span class="fc" id="L798">    }</span>
    

    /**
     * Draws an arrow above the tank taking the turn.
     *
     * @param tank The tank to draw the arrow above.
     */


    public void drawArrowAboveTank(Tank tank) {
<span class="fc" id="L809">        float arrowX = tank.getX() + tank.getWidth() / 2;</span>
<span class="fc" id="L810">        float arrowY = tank.getY() - tank.getHeight() - 10;</span>
        // Drawing the arrow 
<span class="fc" id="L812">        line(arrowX, arrowY - 25, arrowX, arrowY); </span>
<span class="fc" id="L813">        line(arrowX, arrowY, arrowX - 7, arrowY - 7); </span>
<span class="fc" id="L814">        line(arrowX, arrowY, arrowX + 7, arrowY - 7); </span>
<span class="fc" id="L815">    }</span>

    /**
     * Displays an indicator if the current tank has a larger projectile ready.
     *
     * @param currentTank The current tank.
     */

    public void displayLargerProjectileIndicator(Tank currentTank) {
<span class="pc bpc" id="L824" title="1 of 2 branches missed.">        if (currentTank.isNextProjectileLarge()) {</span>
<span class="nc" id="L825">            fill(255, 0, 0); // Red color for indication</span>
<span class="nc" id="L826">            textSize(18);</span>
<span class="nc" id="L827">            textAlign(LEFT);</span>
<span class="nc" id="L828">            text(&quot;Larger Projectile Ready!&quot;, 10, height - 10); // Display at the bottom-left of the screen</span>
        }
<span class="fc" id="L830">    }</span>
    
    



  /**
    * Receive key pressed signal from the keyboard.
    */

@Override
public void keyPressed() {
<span class="nc" id="L842">    Tank currentTank = tanks.get(currentTankIndex);</span>
<span class="nc" id="L843">    char playerIdentifier = currentTank.getPlayerIdentifier();</span>
<span class="nc" id="L844">    int currentScore = scoreboard.getScore(playerIdentifier);</span>

<span class="nc bnc" id="L846" title="All 2 branches missed.">    if (gameOver) {</span>
<span class="nc bnc" id="L847" title="All 2 branches missed.">        if (key == 'r') {</span>
<span class="nc" id="L848">            restartGame();</span>
<span class="nc" id="L849">            return;</span>
        }
    } else {
<span class="nc bnc" id="L852" title="All 2 branches missed.">        if (keyCode == RIGHT) {</span>
<span class="nc" id="L853">            int newY = TerrainHeightAtX((int) currentTank.getX(), yCoordinates, xCoordinates);</span>
<span class="nc" id="L854">            currentTank.moveRight(newY);</span>
<span class="nc bnc" id="L855" title="All 2 branches missed.">        } else if (keyCode == LEFT) {</span>
<span class="nc" id="L856">            int newY = TerrainHeightAtX((int) currentTank.getX(), yCoordinates, xCoordinates);</span>
<span class="nc" id="L857">            currentTank.moveLeft(newY);</span>
<span class="nc bnc" id="L858" title="All 4 branches missed.">        } else if (keyCode == UP || keyCode == DOWN) {</span>
<span class="nc" id="L859">            float angleChange = 0;</span>
<span class="nc bnc" id="L860" title="All 2 branches missed.">            if (keyCode == UP) {</span>
<span class="nc" id="L861">                angleChange = ROTATION_SPEED / FPS;</span>
<span class="nc bnc" id="L862" title="All 2 branches missed.">            } else if (keyCode == DOWN) {</span>
<span class="nc" id="L863">                angleChange = -ROTATION_SPEED / FPS;</span>
            }
<span class="nc" id="L865">            currentTank.changeStickAngle(angleChange);</span>
<span class="nc bnc" id="L866" title="All 2 branches missed.">        } else if (keyCode == ' ') {</span>
<span class="nc" id="L867">            currentTank.fire();</span>
<span class="nc" id="L868">            currentTankIndex = (currentTankIndex + 1) % tanks.size();</span>
<span class="nc" id="L869">            wind += random(-5, 5);</span>
<span class="nc" id="L870">            wind = constrain(wind, -35, 35);</span>
<span class="nc" id="L871">            updateWindImage();</span>
<span class="nc" id="L872">            arrowDisplayStartTime = millis();</span>
<span class="nc bnc" id="L873" title="All 4 branches missed.">        } else if (keyCode == 'W' || keyCode == 'w') {</span>
<span class="nc" id="L874">            float newPower = Math.min(currentTank.getPower() + (36.0f / FPS), currentTank.getHealth());</span>
<span class="nc" id="L875">            currentTank.setPower(newPower);</span>
<span class="nc bnc" id="L876" title="All 4 branches missed.">        } else if (keyCode == 'S' || keyCode == 's') {</span>
<span class="nc" id="L877">            float newPower = Math.max(currentTank.getPower() - (36.0f / FPS), 0);</span>
<span class="nc" id="L878">            currentTank.setPower(newPower);</span>
<span class="nc bnc" id="L879" title="All 4 branches missed.">        } else if (key == 'r' &amp;&amp; currentScore &gt;= 20) {</span>
<span class="nc bnc" id="L880" title="All 2 branches missed.">            if (currentTank.getHealth() &lt; 100) {</span>
<span class="nc" id="L881">                currentTank.setHealth(Math.min(currentTank.getHealth() + 20, 100));</span>
<span class="nc" id="L882">                scoreboard.updateScore(playerIdentifier, -20);</span>
            }
<span class="nc bnc" id="L884" title="All 4 branches missed.">        } else if (key == 'f' &amp;&amp; currentScore &gt;= 10) {</span>
<span class="nc" id="L885">            currentTank.setFuel(currentTank.getFuel() + 200);</span>
<span class="nc" id="L886">            scoreboard.updateScore(playerIdentifier, -10);</span>
<span class="nc bnc" id="L887" title="All 4 branches missed.">        } else if (key == 'p' &amp;&amp; currentScore &gt;= 15) {</span>
<span class="nc" id="L888">            currentTank.setParachutes(currentTank.getParachutes() + 1);</span>
<span class="nc" id="L889">            scoreboard.updateScore(playerIdentifier, -15);</span>
<span class="nc bnc" id="L890" title="All 4 branches missed.">        } else if (key == 'x' &amp;&amp; currentScore &gt;= 20) {</span>
<span class="nc" id="L891">            currentTank.setNextProjectileLarge(true);</span>
<span class="nc" id="L892">            scoreboard.updateScore(playerIdentifier, -20);</span>
        }
    }
<span class="nc" id="L895">}</span>



  /**
    * Receive key released signal from the keyboard.
    */

    
   @Override
   public void keyReleased(){
    

<span class="nc" id="L908">   }</span>

   /**
     * Handles mouse pressed events.
     *
     * @param e The mouse event.
     */

   @Override
   public void mousePressed(MouseEvent e) {
       //TODO - powerups, like repair and extra fuel and teleport
<span class="nc bnc" id="L919" title="All 2 branches missed.">       if (helpBox.isInside(mouseX, mouseY)) {</span>
<span class="nc" id="L920">        helpBox.toggle();</span>
       }


<span class="nc" id="L924">   }</span>

   /**
     * Handles mouse released events.
     *
     * @param e The mouse event.
     */

   @Override
   public void mouseReleased(MouseEvent e) {

<span class="fc" id="L935">   }</span>

   /**
    * Draw all elements in the game by current frame.
    */
   @Override
   public void draw() {

<span class="fc bfc" id="L943" title="All 2 branches covered.">        if (gameOver) {</span>
<span class="fc" id="L944">            displayWinner();</span>
<span class="fc" id="L945">            return;</span>
        }
    
<span class="fc" id="L948">       image(background[currentlevel], 0, 0);</span>

<span class="fc" id="L950">       manageTanks();</span>
<span class="fc" id="L951">       manageExplosions();</span>


<span class="pc bpc" id="L954" title="1 of 4 branches missed.">    if (!tanks.isEmpty() &amp;&amp; currentTankIndex &lt; tanks.size()) {</span>
<span class="fc bfc" id="L955" title="All 2 branches covered.">        for (Tank tank : tanks) {</span>
<span class="fc" id="L956">            updateTankState(tank);  // Ensures updateTankState method handles empty scenarios</span>
<span class="fc" id="L957">            tank.draw();</span>
<span class="fc" id="L958">        }</span>
    }
<span class="fc" id="L960">       drawTerrain();</span>

       //----------------------------------
       //display HUD:
       //----------------------------------

<span class="pc bpc" id="L966" title="2 of 4 branches missed.">       if (!tanks.isEmpty() &amp;&amp; currentTankIndex &lt; tanks.size()){</span>

<span class="fc" id="L968">        String playerTurnLabel = &quot;Player &quot; + (char)('A' + currentTankIndex) + &quot;'s Turn&quot;;</span>
<span class="fc" id="L969">       fill(0); // Set text color to black</span>
<span class="fc" id="L970">       textSize(18); // Set text size</span>
<span class="fc" id="L971">       textAlign(LEFT); // Align text to the left</span>
<span class="fc" id="L972">       text(playerTurnLabel, 30, 32); // Adjust position as needed</span>
<span class="pc bpc" id="L973" title="1 of 2 branches missed.">       if (fuelImage != null) {</span>
        
<span class="fc" id="L975">        image(fuelImage, 175, 10, 27, 27); </span>
       }

<span class="pc bpc" id="L978" title="1 of 2 branches missed.">       if (parachuteImage != null) {</span>
        
<span class="fc" id="L980">        image(parachuteImage, 175, 47, 27, 27); </span>
       }

<span class="pc bpc" id="L983" title="1 of 2 branches missed.">       if (currentWindImage != null) {</span>
        
<span class="fc" id="L985">        image(currentWindImage, WIDTH - 195, 8, 50, 50); </span>
       }


<span class="fc" id="L989">       drawHealthBar();</span>
<span class="fc" id="L990">       drawPower();</span>

<span class="fc bfc" id="L992" title="All 2 branches covered.">       if (millis() - arrowDisplayStartTime &lt; 1000) {</span>
<span class="fc" id="L993">        Tank currentTank = tanks.get(currentTankIndex);</span>
<span class="fc" id="L994">        drawArrowAboveTank(currentTank);</span>
    }


<span class="fc" id="L998">       int x = 205;</span>
<span class="fc bfc" id="L999" title="All 2 branches covered.">       for(Tank tank:tanks){</span>
<span class="fc" id="L1000">        tank.draw();</span>
<span class="fc" id="L1001">        tank.updateProjectiles();</span>
<span class="fc" id="L1002">        tank.drawProjectiles();</span>
        
        

<span class="fc bfc" id="L1006" title="All 2 branches covered.">        if (tanks.indexOf(tank) == currentTankIndex) {</span>
<span class="fc" id="L1007">            fill(0); // Set text color to black</span>
<span class="fc" id="L1008">            textSize(21); // Set text size</span>
<span class="fc" id="L1009">            text(tank.getFuel(), x, 34); // Adjust position as needed</span>
        }

<span class="fc bfc" id="L1012" title="All 2 branches covered.">        if (tanks.indexOf(tank) == currentTankIndex) {</span>
<span class="fc" id="L1013">            fill(0); // Set text color to black</span>
<span class="fc" id="L1014">            textSize(21); // Set text size</span>
<span class="fc" id="L1015">            text(tank.getParachutes(), x, 70); // Adjust position as needed</span>
        }

<span class="fc bfc" id="L1018" title="All 2 branches covered.">        if (tanks.indexOf(tank) == currentTankIndex) {</span>
<span class="fc" id="L1019">            fill(0); // Set text color to black</span>
<span class="fc" id="L1020">            textSize(21); // Set text size</span>
<span class="fc" id="L1021">            text((int) wind, WIDTH - 140,39); // Adjust position as needed</span>
        }


<span class="fc" id="L1025">       }</span>

       

<span class="fc" id="L1029">        scoreboard.draw();</span>
<span class="fc" id="L1030">        helpBox.draw();</span>
        
        

       }

<span class="fc" id="L1036">       Tank currentTank = tanks.get(currentTankIndex);</span>
<span class="fc" id="L1037">       displayLargerProjectileIndicator(currentTank);</span>

<span class="pc bpc" id="L1039" title="1 of 2 branches missed.">       if (levelEnded) {</span>

<span class="nc bnc" id="L1041" title="All 2 branches missed.">        if (millis() - levelEndTime &gt;= levelEndDelay) {</span>
<span class="nc" id="L1042">            loadNextLevel();</span>
        }

    } 
        
      else {
<span class="fc" id="L1048">        checkLevelEnd();</span>
    }

<span class="fc" id="L1051">   }</span>


   /**
     * The main method to run the application.
     *
     * @param args The command line arguments.
     */


   public static void main(String[] args) {
<span class="nc" id="L1062">       PApplet.main(&quot;Tanks.App&quot;);</span>
<span class="nc" id="L1063">   }</span>

}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>